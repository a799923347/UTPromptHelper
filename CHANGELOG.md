# 更新日志

## [1.0.0] - 2024-10-15

### 🎉 首次发布

#### 新增功能
- **Git 变更检测**：自动比较当前分支与 master 分支的代码变更
- **智能文件过滤**：自动过滤纯导入语句和注释变更，保留重要业务逻辑变更
- **可编辑提示词模板**：提供专业的单元测试生成提示词模板
- **文件选择功能**：支持选择性生成特定文件的测试，包含全选/全不选功能
- **实时预览**：实时预览将要复制的内容，支持实时更新
- **一键复制**：快速复制提示词到系统剪贴板
- **Cursor 集成**：直接在 Cursor 编辑器中打开项目
- **多平台支持**：支持 macOS、Windows、Linux 操作系统

#### 技术特性
- **Git diff 解析优化**：智能解析 Git diff 输出，准确识别代码变更
- **多 hunk 处理**：支持处理包含多个变更块的复杂文件
- **上下文行处理**：正确处理 Git diff 中的上下文行，避免过早结束 hunk
- **变更识别算法**：使用比例算法判断是否记录 hunk（重要代码行数 ≥ 30% 或总行数 ≤ 3）
- **用户界面**：基于 IntelliJ IDEA DialogWrapper 的响应式界面设计
- **文本选择支持**：文件信息区域支持文本选择，便于复制特定信息

#### 界面设计
- **四区域布局**：文件选择、提示词编辑、预览、操作按钮
- **等宽字体**：使用 Monospaced 字体确保代码显示一致性
- **滚动支持**：所有文本区域支持滚动查看
- **边框分组**：使用 TitledBorder 清晰分组各个功能区域
- **响应式更新**：选择变化和编辑操作实时更新预览

#### 提示词模板
```
基于代码库的现有单元测试风格，为以下变更生成单元测试，具体要求：

测试覆盖：确保测试覆盖所有变更的代码行，包括边界条件和异常场景。

测试类创建：优先创建新的测试类（如果尚未存在），保持与生产代码的包结构一致（例如测试类放在 src/test/java对应包下）。

测试运行器：优先使用 MockitoJUnitRunner进行依赖mock和测试执行。仅在必要时（如无法通过Mockito处理静态方法或final类时）才使用 PowerMockRunner。

Mock策略：避免过度mock；只在必要时mock静态方法或复杂依赖。使用Mockito进行对象mock，保持测试简洁。

验证与修复：生成测试代码后，自动检查编译错误和运行通过情况（例如通过IDE或构建工具验证），如有问题（如缺少依赖或语法错误），进行修复以确保测试可运行。

代码风格：遵循代码库现有的测试命名约定（如类名以 Test结尾）、断言风格（如使用AssertJ或JUnit断言）和结构（如使用 @Before初始化）。

需要覆盖的代码如下：
```

#### 文件信息显示格式
```
文件名
变更行数: X 处
位置: 行号范围1, 行号范围2, ...
```

#### 复制内容格式
```
[提示词模板内容]

文件名1
   变更行数: X 处
   具体位置: 行号范围1, 行号范围2, ...

文件名2
   变更行数: Y 处
   具体位置: 行号范围3, 行号范围4, ...
```

### 🔧 技术实现

#### 核心类
- **GitCompareAction**：主要的 Action 类，实现插件入口点
- **DialogWrapper**：自定义对话框实现，提供用户界面
- **Git diff 解析器**：解析 Git diff 输出，提取变更信息
- **变更过滤器**：过滤不重要的变更，保留核心业务逻辑

#### 关键算法
- **Hunk 处理算法**：智能处理 Git diff 中的变更块
- **变更识别算法**：基于重要代码行数比例判断是否记录变更
- **文件过滤算法**：识别和过滤导入语句、注释等非核心变更

#### 依赖关系
- **IntelliJ IDEA Platform**：基于 IntelliJ IDEA 插件平台
- **Java Swing**：使用 Swing 组件构建用户界面
- **Git**：依赖系统 Git 命令进行版本控制操作

### 🐛 已知问题修复

#### Git diff 解析问题
- **问题**：上下文行过早结束 hunk，导致包含注释的重要代码变更被分割
- **修复**：改进解析逻辑，只有在遇到新的 `@@` 时才结束当前 hunk
- **影响**：现在能正确识别包含注释的重要代码变更

#### 变更识别准确性
- **问题**：某些重要代码变更被误判为非重要变更
- **修复**：使用比例算法判断，重要代码行数 ≥ 30% 或总行数 ≤ 3 时记录
- **影响**：提高了变更识别的准确性和完整性

#### 多 hunk 文件处理
- **问题**：多 hunk 文件的部分变更未被识别
- **修复**：改进 hunk 处理逻辑，确保所有 hunk 都被正确处理
- **影响**：现在能正确处理包含多个变更块的复杂文件

### 📋 系统要求

- **IntelliJ IDEA**：2020.1 或更高版本
- **Java**：JDK 8 或更高版本
- **操作系统**：macOS 10.14+、Windows 10+、Linux (Ubuntu 18.04+)
- **Git**：2.0 或更高版本
- **内存**：建议 4GB 以上可用内存

### 📦 安装包信息

- **文件名**：`UTPromptHelper-v1.0.jar`
- **大小**：约 11.8KB
- **格式**：标准 JAR 文件
- **兼容性**：支持 IntelliJ IDEA 2020.1+

### 🚀 使用方式

1. **安装插件**：通过 IntelliJ IDEA 插件管理器安装 JAR 文件
2. **启动功能**：选择 `Tools` → `获取UT提示词`
3. **选择文件**：在文件列表中选择需要生成测试的文件
4. **编辑提示词**：根据需要修改默认提示词模板
5. **预览复制**：查看预览内容并复制到剪贴板
6. **打开 Cursor**：直接在 Cursor 编辑器中打开项目

### 📚 文档

- **README.md**：项目介绍和基本使用说明
- **USAGE_GUIDE.md**：详细使用指南和最佳实践
- **TROUBLESHOOTING.md**：故障排除指南和常见问题解答

### 🤝 贡献者

- 初始版本开发和测试
- 用户界面设计
- 文档编写和维护

### 📄 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

---

**感谢使用 UTPromptHelper！** 🎉

如有问题或建议，请在 GitHub 上创建 Issue 或联系维护者。
