# UTPromptHelper - IntelliJ IDEA 插件

## 📖 简介

UTPromptHelper 是一个专为 IntelliJ IDEA 设计的插件，用于自动生成单元测试提示词。该插件通过比较当前分支与 master 分支的代码变更，生成结构化的提示词，帮助开发者快速为代码变更生成高质量的单元测试。

## ✨ 主要功能

- 🔍 **智能代码变更检测**：自动识别 Git 分支间的代码变更
- 📝 **可编辑提示词模板**：提供专业的测试生成提示词模板
- 🎯 **文件选择功能**：支持选择性生成特定文件的测试
- 👁️ **实时预览**：实时预览将要复制的内容
- 📋 **一键复制**：快速复制提示词到剪贴板
- 🚀 **Cursor 集成**：直接在 Cursor 编辑器中打开项目

## 🚀 安装方法

### 方法一：从 JAR 文件安装

1. 下载插件包：`UTPromptHelper-v1.0.jar`
2. 打开 IntelliJ IDEA
3. 进入插件管理：`File` → `Settings` → `Plugins`
4. 点击齿轮图标 → `Install Plugin from Disk...`
5. 选择下载的 JAR 文件
6. 重启 IntelliJ IDEA

### 方法二：从源码构建

```bash
# 克隆项目
git clone <repository-url>
cd UTPromptHelper

# 构建插件
export JAVA_HOME=/path/to/java
./gradlew buildPlugin

# 插件包位置
build/distributions/UTPromptHelper-*.zip
```

## 📖 使用指南

### 基本使用流程

1. **启动插件**
   - 在 IntelliJ IDEA 中，选择 `Tools` → `获取UT提示词`
   - 插件会自动比较当前分支与 master 分支的变更

2. **选择文件**
   - 在文件列表中选择需要生成测试的文件
   - 使用 `全选` 或 `全不选` 按钮快速操作
   - 每个文件显示变更行数和具体位置

3. **编辑提示词**
   - 在提示词编辑区域修改默认模板
   - 支持实时预览修改效果

4. **预览和复制**
   - 在预览区域查看最终内容
   - 点击 `📋 复制` 按钮复制到剪贴板
   - 点击 `🚀 在 Cursor 中打开` 直接在 Cursor 中打开项目

### 界面说明

#### 文件选择区域
```
┌─────────────────────────────────────────────────────┐
│ 选择要生成单元测试的文件                            │
│ [全选] [全不选]                                    │
│ ┌─────────────────────────────────────────────────┐ │
│ │ ☑️ src/main/java/Example.java                  │ │
│ │    变更行数: 2 处                                │ │
│ │    位置: 10-15, 25-30                          │ │
│ └─────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

#### 提示词编辑区域
```
┌─────────────────────────────────────────────────────┐
│ UT提示词 (可编辑)                                   │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 基于代码库的现有单元测试风格，为以下变更生成... │ │
│ │ 测试覆盖：确保测试覆盖所有变更的代码行...      │ │
│ └─────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

#### 预览区域
```
┌─────────────────────────────────────────────────────┐
│ 预览 (将复制的内容)                                 │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 基于代码库的现有单元测试风格，为以下变更生成... │ │
│ │                                                 │ │
│ │ src/main/java/Example.java                     │ │
│ │    变更行数: 2 处                                │ │
│ │    具体位置: 10-15, 25-30                      │ │
│ └─────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

## 🎯 默认提示词模板

插件提供专业的测试生成提示词模板：

```
基于代码库的现有单元测试风格，为以下变更生成单元测试，具体要求：

测试覆盖：确保测试覆盖所有变更的代码行，包括边界条件和异常场景。

测试类创建：优先创建新的测试类（如果尚未存在），保持与生产代码的包结构一致（例如测试类放在 src/test/java对应包下）。

测试运行器：优先使用 MockitoJUnitRunner进行依赖mock和测试执行。仅在必要时（如无法通过Mockito处理静态方法或final类时）才使用 PowerMockRunner。

Mock策略：避免过度mock；只在必要时mock静态方法或复杂依赖。使用Mockito进行对象mock，保持测试简洁。

验证与修复：生成测试代码后，自动检查编译错误和运行通过情况（例如通过IDE或构建工具验证），如有问题（如缺少依赖或语法错误），进行修复以确保测试可运行。

代码风格：遵循代码库现有的测试命名约定（如类名以 Test结尾）、断言风格（如使用AssertJ或JUnit断言）和结构（如使用 @Before初始化）。

需要覆盖的代码如下：
```

## 🔧 技术特性

### Git 变更检测
- 智能解析 Git diff 输出
- 准确识别包含注释的重要代码变更
- 支持多 hunk 文件处理
- 过滤导入语句和纯注释变更

### 用户界面
- 基于 IntelliJ IDEA 的 DialogWrapper
- 响应式布局设计
- 实时预览功能
- 可选择的文本区域

### 集成功能
- 剪贴板复制
- Cursor 编辑器集成
- 跨平台支持（macOS、Windows、Linux）

## 📋 系统要求

- **IntelliJ IDEA**: 2020.1 或更高版本
- **Java**: JDK 8 或更高版本
- **操作系统**: macOS、Windows、Linux
- **Git**: 已配置的 Git 仓库

## 🐛 故障排除

### 常见问题

**Q: 插件无法检测到代码变更**
A: 确保当前项目是一个 Git 仓库，并且存在 master 分支。

**Q: 某些文件的变更没有被识别**
A: 插件会过滤纯导入语句和注释变更。如果重要代码变更未被识别，请检查变更是否包含实际的业务逻辑。

**Q: Cursor 打开失败**
A: 确保已安装 Cursor 编辑器，并且可以在命令行中访问 `cursor` 命令。

**Q: 复制功能不工作**
A: 确保选择了至少一个文件，并且预览区域有内容。

### 调试信息

如果遇到问题，可以查看 IntelliJ IDEA 的日志：
- `Help` → `Show Log in Explorer`
- 查找与 `UTPromptHelper` 相关的错误信息

## 🤝 贡献指南

欢迎贡献代码和建议！

1. Fork 项目
2. 创建功能分支：`git checkout -b feature/AmazingFeature`
3. 提交更改：`git commit -m 'Add some AmazingFeature'`
4. 推送到分支：`git push origin feature/AmazingFeature`
5. 创建 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 📞 支持

如果您遇到问题或有建议，请：

1. 查看本文档的故障排除部分
2. 在 GitHub 上创建 Issue
3. 联系维护者

## 🔄 更新日志

### v1.0.0
- 初始版本发布
- 基本的 Git 变更检测功能
- 可编辑的提示词模板
- 文件选择和预览功能
- Cursor 集成支持
- 修复了包含注释的重要代码变更识别问题

---

**享受高效的单元测试生成体验！** 🚀
