# UTPromptHelper 故障排除指南

## 🔍 常见问题诊断

### 1. 插件安装问题

#### 问题：插件无法安装
**症状**：
- 选择 JAR 文件后没有反应
- 显示"插件格式不正确"错误
- 安装后插件列表中没有显示

**解决方案**：
1. **检查 JAR 文件完整性**
   ```bash
   # 验证 JAR 文件
   jar -tf UTPromptHelper-v1.0.jar
   ```

2. **检查 IntelliJ IDEA 版本兼容性**
   - 确保使用 IntelliJ IDEA 2020.1 或更高版本
   - 检查 Java 版本兼容性

3. **重新安装步骤**
   - 完全卸载插件
   - 重启 IntelliJ IDEA
   - 重新安装插件

#### 问题：插件安装后无法启用
**症状**：
- 插件在列表中显示为禁用状态
- 无法勾选启用选项

**解决方案**：
1. 检查插件依赖
2. 更新 IntelliJ IDEA 到最新版本
3. 检查系统权限设置

### 2. 功能使用问题

#### 问题：无法检测到代码变更
**症状**：
- 点击插件后显示"No changes found"
- 文件列表为空
- 提示"all changes are in test files"

**诊断步骤**：
1. **检查 Git 状态**
   ```bash
   # 检查当前分支
   git branch
   
   # 检查与 master 的差异
   git diff master --name-only
   
   # 检查工作区状态
   git status
   ```

2. **检查分支设置**
   ```bash
   # 确保存在 master 分支
   git branch -a
   
   # 如果使用 main 分支，需要重命名
   git branch -m main master
   ```

3. **检查变更类型**
   ```bash
   # 查看具体变更内容
   git diff master
   ```

**解决方案**：
- 确保当前分支与 master 有差异
- 检查是否有未提交的变更
- 确认变更不是纯测试文件

#### 问题：某些文件变更未被识别
**症状**：
- 部分文件显示在列表中，部分没有
- 重要代码变更被过滤掉

**诊断步骤**：
1. **检查 Git diff 输出**
   ```bash
   # 查看特定文件的变更
   git diff master -- path/to/file.java
   ```

2. **分析变更内容**
   - 检查是否包含纯导入语句
   - 检查是否包含纯注释
   - 确认包含实际业务逻辑

**解决方案**：
- 如果变更确实重要但被过滤，这是正常行为
- 插件会过滤纯导入和注释变更
- 确保变更包含实际的代码逻辑

#### 问题：文件信息显示不正确
**症状**：
- 变更行数显示错误
- 位置信息不准确
- 文件路径显示异常

**诊断步骤**：
1. **检查 Git diff 格式**
   ```bash
   # 查看原始 diff 输出
   git diff master --stat
   ```

2. **验证文件路径**
   - 确认文件在项目根目录下
   - 检查路径分隔符是否正确

**解决方案**：
- 重新运行插件
- 检查 Git 配置
- 确认项目结构正确

### 3. 界面操作问题

#### 问题：选择框无法操作
**症状**：
- 点击选择框没有反应
- 全选/全不选按钮不工作
- 预览区域不更新

**解决方案**：
1. **检查界面状态**
   - 确认对话框完全加载
   - 检查是否有错误提示

2. **重新操作**
   - 关闭对话框重新打开
   - 重启 IntelliJ IDEA

#### 问题：文本无法选择
**症状**：
- 文件信息文本无法选中
- 复制功能不工作

**解决方案**：
- 确认使用的是最新版本插件
- 检查系统剪贴板功能
- 尝试重新选择文本

#### 问题：预览内容不更新
**症状**：
- 修改提示词后预览不变化
- 选择文件后预览不更新

**解决方案**：
1. **检查监听器**
   - 确认文档监听器正常工作
   - 检查事件绑定

2. **手动刷新**
   - 重新选择文件
   - 重新编辑提示词

### 4. 复制和集成问题

#### 问题：复制功能不工作
**症状**：
- 点击复制按钮没有反应
- 显示"没有选中任何文件"提示
- 剪贴板中没有内容

**诊断步骤**：
1. **检查选择状态**
   - 确认至少选择了一个文件
   - 检查预览区域是否有内容

2. **检查系统剪贴板**
   ```bash
   # 测试剪贴板功能
   echo "test" | pbcopy  # macOS
   echo "test" | clip    # Windows
   ```

**解决方案**：
- 确保选择了文件
- 检查系统剪贴板权限
- 尝试手动复制预览内容

#### 问题：Cursor 打开失败
**症状**：
- 点击 Cursor 按钮报错
- 显示"无法获取项目路径"错误
- 显示"打开 Cursor 失败"错误

**诊断步骤**：
1. **检查项目路径**
   ```bash
   # 确认项目路径
   pwd
   ```

2. **检查 Cursor 安装**
   ```bash
   # 检查 Cursor 命令
   which cursor
   cursor --version
   ```

3. **检查系统权限**
   - 确认有执行命令的权限
   - 检查防火墙设置

**解决方案**：
1. **安装 Cursor**
   - 从官网下载安装 Cursor
   - 确保添加到系统 PATH

2. **配置命令别名**
   ```bash
   # macOS
   alias cursor="open -a Cursor"
   
   # Windows
   # 添加到系统 PATH
   ```

3. **手动打开**
   - 使用 Cursor 手动打开项目
   - 复制项目路径到 Cursor

### 5. 性能问题

#### 问题：插件运行缓慢
**症状**：
- 点击插件后响应很慢
- 界面加载时间长
- 操作卡顿

**解决方案**：
1. **检查项目大小**
   - 大型项目可能需要更长时间
   - 考虑使用 `.gitignore` 排除不必要文件

2. **优化 Git 操作**
   ```bash
   # 清理 Git 缓存
   git gc --prune=now
   
   # 检查 Git 状态
   git status --porcelain
   ```

3. **系统资源**
   - 关闭其他占用资源的程序
   - 增加可用内存

#### 问题：内存占用过高
**症状**：
- IntelliJ IDEA 内存使用过高
- 系统响应缓慢

**解决方案**：
1. **调整 JVM 参数**
   - 增加堆内存大小
   - 优化垃圾回收设置

2. **限制处理文件数量**
   - 分批处理大型变更
   - 使用文件过滤功能

### 6. 兼容性问题

#### 问题：与其他插件冲突
**症状**：
- 插件功能异常
- IntelliJ IDEA 崩溃
- 界面显示错误

**解决方案**：
1. **禁用其他插件**
   - 逐个禁用插件测试
   - 找出冲突的插件

2. **更新插件版本**
   - 更新到最新版本
   - 检查兼容性说明

#### 问题：操作系统兼容性
**症状**：
- 在特定操作系统上无法工作
- 路径处理错误
- 命令执行失败

**解决方案**：
1. **检查系统要求**
   - 确认操作系统版本
   - 检查 Java 版本

2. **路径处理**
   - 检查路径分隔符
   - 确认文件权限

## 🔧 调试技巧

### 1. 启用调试模式
```bash
# 设置 IntelliJ IDEA 调试参数
-Didea.log.debug=true
-Didea.log.level=DEBUG
```

### 2. 查看日志文件
- **macOS**: `~/Library/Logs/JetBrains/IntelliJIdea2023.3/`
- **Windows**: `%USERPROFILE%\AppData\Local\JetBrains\IntelliJIdea2023.3\log\`
- **Linux**: `~/.cache/JetBrains/IntelliJIdea2023.3/log/`

### 3. 检查 Git 配置
```bash
# 检查 Git 配置
git config --list

# 检查远程仓库
git remote -v

# 检查分支信息
git branch -vv
```

### 4. 测试 Git 命令
```bash
# 测试 Git diff 命令
git diff master --name-only
git diff master --stat
git diff master --numstat
```

## 📞 获取帮助

### 1. 查看日志
- 打开 IntelliJ IDEA 日志
- 查找与 UTPromptHelper 相关的错误
- 记录错误信息和堆栈跟踪

### 2. 收集信息
- 操作系统版本
- IntelliJ IDEA 版本
- Java 版本
- Git 版本
- 项目结构信息

### 3. 联系支持
- 在 GitHub 上创建 Issue
- 提供详细的错误信息
- 附上相关的日志文件

### 4. 社区支持
- 查看 GitHub 讨论区
- 参与社区讨论
- 分享解决方案

## 🔄 重置和恢复

### 1. 重置插件设置
- 删除插件配置目录
- 重新安装插件
- 恢复默认设置

### 2. 清理缓存
```bash
# 清理 IntelliJ IDEA 缓存
# 在 Help 菜单中选择 "Invalidate Caches and Restart"
```

### 3. 重新安装
- 完全卸载插件
- 清理相关文件
- 重新安装最新版本

---

**如果问题仍然存在，请提供详细的错误信息和系统环境，我们会尽快帮助您解决！** 🚀
