# UTPromptHelper 使用指南

## 🎯 快速开始

### 第一步：安装插件
1. 下载 `UTPromptHelper-v1.0.jar`
2. 在 IntelliJ IDEA 中：`File` → `Settings` → `Plugins`
3. 点击齿轮图标 → `Install Plugin from Disk...`
4. 选择 JAR 文件并重启 IDEA

### 第二步：使用插件
1. 确保你在一个 Git 仓库中
2. 选择 `Tools` → `获取UT提示词`
3. 插件会自动分析代码变更

## 📋 详细使用步骤

### 1. 启动插件

**方法一：通过菜单**
- 点击顶部菜单 `Tools`
- 选择 `获取UT提示词`

**方法二：通过快捷键**
- 插件支持自定义快捷键（在设置中配置）

### 2. 理解界面布局

插件界面分为四个主要区域：

```
┌─────────────────────────────────────────────────────────┐
│                    UTPromptHelper                       │
├─────────────────────────────────────────────────────────┤
│ ┌─ 文件选择区域 ──────────────────────────────────────┐ │
│ │ 选择要生成单元测试的文件                            │ │
│ │ [全选] [全不选]                                    │ │
│ │ ┌─────────────────────────────────────────────────┐ │ │
│ │ │ ☑️ 文件1.java                                   │ │ │
│ │ │ ☑️ 文件2.java                                   │ │ │
│ │ └─────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─ 提示词编辑区域 ────────────────────────────────────┐ │
│ │ UT提示词 (可编辑)                                   │ │
│ │ ┌─────────────────────────────────────────────────┐ │ │
│ │ │ 基于代码库的现有单元测试风格...                │ │ │
│ │ └─────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─ 预览区域 ──────────────────────────────────────────┐ │
│ │ 预览 (将复制的内容)                                 │ │
│ │ ┌─────────────────────────────────────────────────┐ │ │
│ │ │ 最终生成的提示词内容...                        │ │ │
│ │ └─────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─ 操作按钮区域 ──────────────────────────────────────┐ │
│ │                                    [📋 复制] [🚀 Cursor] │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 3. 文件选择操作

#### 查看文件信息
每个文件显示以下信息：
- **文件名**：完整的文件路径
- **变更行数**：检测到的变更数量
- **位置**：具体的行号范围

#### 选择操作
- **单个选择**：点击文件前的复选框
- **全选**：点击 `全选` 按钮
- **全不选**：点击 `全不选` 按钮
- **实时预览**：选择变化时预览区域会自动更新

#### 文件信息文本选择
- 文件信息区域支持文本选择
- 可以复制文件名、变更行数等信息
- 使用 `Ctrl+A` 全选，`Ctrl+C` 复制

### 4. 编辑提示词

#### 默认模板
插件提供专业的测试生成模板，包含：
- 测试覆盖要求
- 测试类创建规范
- 测试运行器选择
- Mock 策略指导
- 验证与修复流程
- 代码风格要求

#### 自定义编辑
- 在提示词编辑区域直接修改
- 支持多行编辑
- 自动换行功能
- 实时预览效果

#### 编辑技巧
- 使用 `Ctrl+A` 全选文本
- 使用 `Ctrl+Z` 撤销操作
- 使用 `Ctrl+Y` 重做操作
- 支持复制粘贴操作

### 5. 预览和复制

#### 预览功能
- 实时显示最终复制内容
- 包含提示词和选中的文件信息
- 格式化的输出结构

#### 复制操作
1. 点击 `📋 复制选中内容的UT提示词到剪贴板` 按钮
2. 系统会复制预览区域的内容
3. 显示成功提示信息

#### 复制内容格式
```
基于代码库的现有单元测试风格，为以下变更生成单元测试，具体要求：
测试覆盖：确保测试覆盖所有变更的代码行，包括边界条件和异常场景。
...

需要覆盖的代码如下：

src/main/java/com/example/Service.java
   变更行数: 3 处
   具体位置: 10-15, 25-30, 45-50

src/main/java/com/example/Controller.java
   变更行数: 1 处
   具体位置: 20-25
```

### 6. Cursor 集成

#### 打开 Cursor
1. 点击 `🚀 在 Cursor 中打开` 按钮
2. 插件会自动打开 Cursor 编辑器
3. 显示成功提示信息

#### 系统要求
- 已安装 Cursor 编辑器
- 可以在命令行中访问 `cursor` 命令
- 支持的操作系统：macOS、Windows、Linux

#### 故障排除
如果 Cursor 打开失败：
1. 确保 Cursor 已正确安装
2. 检查命令行是否可以访问 `cursor` 命令
3. 查看错误提示信息

## 🎨 界面定制

### 字体设置
- 使用等宽字体（Monospaced）
- 字体大小：12px
- 支持系统字体缩放

### 布局调整
- 文件选择区域：600x300 像素
- 提示词编辑区域：600x80 像素
- 预览区域：自适应高度
- 区域间距：10 像素

### 颜色主题
- 遵循 IntelliJ IDEA 主题设置
- 自动适应深色/浅色模式
- 保持一致的视觉体验

## 🔧 高级功能

### Git 变更检测

#### 支持的变更类型
- 新增代码行
- 修改代码行
- 删除代码行
- 包含注释的重要变更

#### 过滤规则
- 自动过滤纯导入语句变更
- 过滤纯注释变更
- 保留包含业务逻辑的变更

#### 多文件支持
- 支持同时处理多个文件
- 每个文件独立显示变更信息
- 支持批量选择操作

### 提示词模板

#### 模板结构
1. **测试覆盖要求**：确保全面覆盖
2. **测试类创建**：遵循包结构规范
3. **测试运行器**：优先使用 MockitoJUnitRunner
4. **Mock 策略**：避免过度 mock
5. **验证与修复**：自动检查编译和运行
6. **代码风格**：遵循现有约定

#### 自定义模板
- 可以完全替换默认模板
- 支持多行编辑
- 实时预览效果
- 保持格式一致性

## 🐛 常见问题解决

### 问题 1：插件无法启动
**症状**：点击菜单项没有反应
**解决方案**：
1. 检查插件是否正确安装
2. 重启 IntelliJ IDEA
3. 查看插件是否在插件列表中启用

### 问题 2：检测不到代码变更
**症状**：文件列表为空
**解决方案**：
1. 确保当前项目是 Git 仓库
2. 检查是否存在 master 分支
3. 确保有未提交的变更或与 master 有差异

### 问题 3：某些变更未被识别
**症状**：重要代码变更没有显示
**解决方案**：
1. 检查变更是否包含实际的业务逻辑
2. 确认不是纯导入语句或注释变更
3. 查看 Git diff 输出确认变更存在

### 问题 4：复制功能不工作
**症状**：点击复制按钮没有反应
**解决方案**：
1. 确保至少选择了一个文件
2. 检查预览区域是否有内容
3. 确认系统剪贴板功能正常

### 问题 5：Cursor 打开失败
**症状**：点击 Cursor 按钮报错
**解决方案**：
1. 确保 Cursor 已正确安装
2. 检查命令行是否可以访问 `cursor` 命令
3. 在 macOS 上使用 `open -a Cursor` 命令

## 📊 最佳实践

### 1. 文件选择策略
- 优先选择核心业务逻辑文件
- 避免选择纯配置文件
- 批量处理相关文件

### 2. 提示词优化
- 根据项目特点调整模板
- 添加特定的测试要求
- 保持模板的简洁性

### 3. 工作流程
1. 完成代码开发
2. 使用插件生成测试提示词
3. 在 Cursor 中打开项目
4. 使用 AI 生成测试代码
5. 验证和修复测试代码

### 4. 团队协作
- 统一提示词模板
- 分享最佳实践
- 定期更新插件版本

## 🔄 更新和维护

### 检查更新
- 定期检查插件更新
- 关注 GitHub 发布页面
- 查看更新日志

### 备份设置
- 导出自定义提示词模板
- 记录个人配置偏好
- 备份重要设置

### 反馈和贡献
- 报告 bug 和问题
- 提出功能建议
- 参与社区讨论

---

**希望这个指南能帮助您更好地使用 UTPromptHelper！** 🚀
